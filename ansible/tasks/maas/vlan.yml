---
- name: "vlan fabric: {{ fabric_id }} vlan: {{ vlan_id }}"
  block:
    - name: "Load vlan data fabric: {{ fabric_id }} vlan: {{ vlan_id }}"
      command: "maas {{ maas_profile }} vlan read {{ fabric_id }} {{ vlan_id }}"
  rescue:
    - name: "Create fabric: {{ fabric_id }} vlan: {{ vlan_id }}"
      #command: "maas {{ maas_profile }} vlan update {{ fabric_id }} {{ vlan_id }} name='{{ vlan_name }}' description='vlan {{ vlan_name }}'"
      command: "maas {{ maas_profile }} vlans create {{ fabric_id }} vid='{{ vlan_id }}' name='{{ vlan_name }}' description='vlan {{ vlan_name }}'"

#- name: Parse vlan_data
#  set_fact:
#    vlan_data: "{{ maas_data.stdout | from_json }}"
#
#- name: debug
#  debug:
#    msg: "VLAN {{ vlan_id }} on {{ fabric_id }} EXISTS"
#  when: vid in vlan_data
